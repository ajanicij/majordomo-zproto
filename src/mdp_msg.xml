<class
    name = "mdp_msg"
    signature = "4"
    title = "Majordomo Protocol"
    script = "zproto_codec_c"
    package_dir = "../include"
    source_dir = "."
    >
    <!-- This file describes Majordomo Client subprotocol as specified by
    the zproto project from ZeroMQ, found at...

    https://github.com/zeromq/zproto

    The corresponding source and header files are generated by
    running this file through gsl with the zproto_codec_c.gsl
    script, e.g.
    
    $ gsl mdp_msg.xml
    
    Obviously, to do this, one needs to have gsl installed. It can
    be found at
    
    https://github.com/imatix/gsl
    
    -->

    This is Majordomo Protocol version 0.2
    
    
    <!-- As laid out by zproject, the license is in the main dir -->
    <include filename = "../license.xml" />
    
    <!-- This file represents version 0.2 of the Majordomo protocol which
    is documented at http://rfc.zeromq.org/spec:18 -->
    <!-- Protocol version -->
    <define name = "VERSION" value = "2" />

    <!-- Majordomo/Client subprotocol -->
    <message name = "CLIENT REQUEST" id = "1">
    Client sends a request.
        <field name = "version" type = "string" value = "MDPC02">MDP/Client v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "1">REQUEST message id</field>
        <field name = "service" type = "string">Service name</field>
        <field name = "body" type = "msg">Request body</field>
    </message>

    <message name = "CLIENT PARTIAL" id = "2">
    Broker sends a partial response from a worker.
        <field name = "version" type = "string" value = "MDPC02">MDP/Client v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "2">PARTIAL message id</field>
        <field name = "service" type = "string">Service name</field>
        <field name = "body" type = "msg">Response body</field>
    </message>
    
    <message name = "CLIENT FINAL" id = "3">
        <field name = "version" type = "string" value = "MDPC02">MDP/Client v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "3">PARTIAL message id</field>
        <field name = "service" type = "string">Service name</field>
        <field name = "body" type = "msg">Response body</field>
    </message>

    <!-- Majordomo/Worker subprotocol -->
    <message name = "READY" id = "4">
    Worker signals the broker that it is ready to receive requests.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "1">PARTIAL message id</field>
        <field name = "service" type = "string">Service name</field>
    </message>
    
    <message name = "WORKER REQUEST" id = "5">
    Broker sends a request from a client.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "2">PARTIAL message id</field>
        <field name = "address" type = "frame">Client address (envelope stack)</field>
        <field name = "empty" type = "frame">Empty frame</field>
        <field name = "body" type = "msg">Reply body</field>
    </message>
    
    <message name = "WORKER PARTIAL" id = "6">
    Worker sends a partial reply.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "3">PARTIAL message id</field>
        <field name = "address" type = "frame">Client address (envelope stack)</field>
        <field name = "empty" type = "frame">Empty frame</field>
        <field name = "body" type = "msg">Reply body</field>
    </message>

    <message name = "WORKER FINAL" id = "7">
    Worker sends a final reply.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "4">FINAL message id</field>
        <field name = "address" type = "frame">Client address (envelope stack)</field>
        <field name = "empty" type = "frame">Empty frame</field>
        <field name = "body" type = "msg">Reply body</field>
    </message>
    
    <message name = "HEARTBEAT" id = "8">
    Worker or broker sends an asynchronous heartbeat.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "5">HEARTBEAT message id</field>
    </message>
    
    <message name = "DISCONNECT" id = "9">
    Worker or broker sends an asynchronous disconnect.
        <field name = "version" type = "string" value = "MDPW02">MDP/Worker v0.2</field>
        <field name = "messageid" type = "number" size = "1" value = "6">DISCONNECT message id</field>
    </message>

</class>
